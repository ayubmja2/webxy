import{Q as z,l as i,x as A,y as N,s as u,f as b,w as v,q as $,o as n,a as s,d as g,n as M,e as D,c,t as G,h as f,m as w,F as S,g as Q,k as V,p as H,A as J,u as h,i as k}from"./app-B0POS_qi.js";import{_ as K,P as C}from"./Panel-Cm2YOkga.js";import{_ as W}from"./RecipeCard-CkqBh5q-.js";import{_ as X}from"./UserCard-CyvjUzvu.js";import{d as Y}from"./Debounce-DarU5fBN.js";import{_ as Z}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ApplicationLogo-1RqGdrda.js";const ee={class:"w-full p-4 grid grid-cols-1 md:grid-cols-4 gap-4"},te={class:"col-span-1 md:col-span-2 h-full overflow-y-auto"},se={class:"sticky top-0 z-10 flex justify-center space-x-4 mb-4"},re={key:0,class:"ml-2 bg-darkOrange text-mintGreen rounded-full px-2"},ae={key:0,class:"bg-red-200 p-4 mb-4 rounded-lg"},le={key:1,class:"bg-red-200 p-4 mb-4 rounded-lg"},oe={key:4},ne={class:"md:block row-start-1 col-span-1 rounded-lg"},ue={class:"container bg-green-200 rounded-lg md:mb-8 p-4 row-start-1 md:m-auto"},ie={class:"container text-center"},ce={class:"hidden md:block row-start-2 bg-green-200 p-4 rounded-lg text-center"},pe=["onClick"],de={class:"flex justify-center"},ve={class:"flex space-x-4 ml-2 mt-4"},fe={__name:"Index",setup(ge){const{props:m}=z(),p=i([]),O=i(0),d=i(!1),_=i(!1),q=i(m.categories),l=i(m.recipes),o=i(m.users),x=i(m.query||""),a=i("recipes"),y=i(m.showFollowing),U=async()=>{try{const e=await $.get("/api/notifications/unread");p.value=e.data}catch(e){console.log(e)}},B=async()=>{try{await $.post("/api/notifications/read"),p.value=[],F("following"),O.value=0}catch(e){console.log(e)}};A(()=>{U(),Echo.private("recipes").listen("RecipeUploaded",e=>{U()}).notification(e=>{p.value.push(e),p.value=[...p.value]})});const F=e=>{const t=e==="following"?"/recipes?filter=following":"/recipes";u.get(t,{},{preserveScroll:!0,preserveState:!0,onSuccess:r=>{l.value=r.props.recipes,y.value=r.props.showFollowing}})};N(a,async()=>{x.value="",a.value==="recipes"?await u.visit("/recipes",{preserveScroll:!0,preserveState:!0,onSuccess:e=>{l.value=e.props.recipes,o.value={data:[]},d.value=!1}}):a.value==="users"&&await u.visit("/recipes",{preserveScroll:!0,preserveState:!0,onSuccess:e=>{o.value=e.props.users,l.value={data:[]},d.value=!1}})});const T=async()=>{d.value=!1,_.value=!0,await u.get("/search",{query:x.value,type:a.value},{preserveScroll:!0,preserveState:!0,onSuccess:e=>{a.value==="recipes"?(l.value=e.props.recipes,o.value={data:[]}):(o.value=e.props.users,l.value={data:[]}),history.replaceState(null,"","/recipes"),d.value=!0,_.value=!1}})},E=()=>{l.value.next_page_url?u.get(l.value.next_page_url,{},{preserveScroll:!0,preserveState:!0,onSuccess:e=>{l.value.data=l.value.data.concat(e.props.recipes.data),l.value.next_page_url=e.props.recipes.next_page_url,history.replaceState(null,"","/recipes")}}):a.value==="users"&&o.value.next_page_url&&u.get(o.value.next_page_url,{},{preserveScroll:!0,preserveState:!0,onSuccess:e=>{o.value.data=o.value.data.concat(e.props.users.data),o.value.next_page_url=e.props.users.next_page_url,history.replaceState(null,"","/profile")}})},P=async()=>{const e=(a.value==="recipes","/recipes");await u.visit(e,{preserveScroll:!0,preserveState:!0,only:["recipes","users"],onSuccess:t=>{a.value==="recipes"?(l.value=t.props.recipes||{data:[],next_page_url:null},o.value={data:[]}):a.value==="users"&&(o.value=t.props.users||{data:[],next_page_url:null},l.value={data:[]}),d.value=!1}})},R=Y(()=>{T()},300);N(x,async e=>{e.trim()===""?await P():R()});const I=e=>{u.get(`/recipes/${e}`,{},{preserveState:!1,preserveScroll:!0})},L=e=>u.get(`/profile/${e}`,{},{preserveScroll:!0,preserveState:!0}),j=e=>{u.get(`/categories/${e}`)};return window.addEventListener("popstate",function(e){const t=window.location.href;(t.includes("?query=")||t.includes("&type="))&&u.get("/recipes",{},{preserveState:!1,preserveScroll:!0})}),(e,t)=>(n(),b(K,null,{default:v(()=>[s("div",ee,[s("div",te,[s("div",se,[g(C,{class:"container py-3 text-center space-x-8"},{default:v(()=>[s("button",{onClick:t[0]||(t[0]=r=>F("all")),class:M([y.value?"bg-gray-300":"bg-darkOrange text-mintGreen","p-2 px-4 rounded-lg"])},"Explore",2),s("button",{onClick:B,class:M([y.value?"bg-darkOrange text-mintGreen":"bg-gray-300","p-2 px-4 rounded-lg"])},[t[3]||(t[3]=D("Following ")),p.value.length>0?(n(),c("span",re,G(p.value.length),1)):f("",!0)],2)]),_:1})]),g(C,null,{default:v(()=>[l.value.data.length===0&&a.value==="recipes"&&d.value&&!_.value?(n(),c("div",ae,t[4]||(t[4]=[s("p",null,"No recipes found. Maybe you should upload one!",-1)]))):f("",!0),o.value.data.length===0&&a.value==="users"&&d.value&&!_.value?(n(),c("div",le,t[5]||(t[5]=[s("p",null,"No users found.",-1)]))):f("",!0),a.value==="recipes"?(n(!0),c(S,{key:2},w(l.value.data,r=>(n(),b(W,{key:r.id,recipe:r,navigateToRecipe:I},null,8,["recipe"]))),128)):f("",!0),a.value==="users"?(n(!0),c(S,{key:3},w(o.value.data,r=>(n(),b(X,{key:r.id,user:r,navigateToUserProfile:L,class:"mb-6"},null,8,["user"]))),128)):f("",!0),a.value==="recipes"?(n(),c("div",oe,[l.value.next_page_url?(n(),c("button",{key:0,onClick:E,class:"bg-blue-500 text-mintGreen py-2 px-4 rounded-lg mt-4 w-full"}," Load More ")):f("",!0)])):f("",!0)]),_:1})]),s("div",ne,[g(C,null,{default:v(()=>[s("div",ue,[t[8]||(t[8]=s("h2",{class:"max-md:hidden text-lg font-bold mb-4 text-center"},"Search",-1)),s("div",ie,[s("form",{onSubmit:Q(T,["prevent"]),class:"max-md:space-x-4"},[V(s("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=r=>x.value=r),class:"p-2 md:w-full rounded-lg mb-2 max-md:text-center",placeholder:"Search for recipe or user"},null,512),[[H,x.value]]),V(s("select",{"onUpdate:modelValue":t[2]||(t[2]=r=>a.value=r),class:"p-2 md:w-full rounded-lg mb-2 max-md:text-center"},t[6]||(t[6]=[s("option",{value:"recipes"},"Recipes",-1),s("option",{value:"users"},"Users",-1)]),512),[[J,a.value]]),t[7]||(t[7]=s("button",{type:"submit",class:"bg-darkOrange text-mintGreen py-2 px-4 rounded-lg md:w-full"},"Search",-1))],32)])]),s("div",ce,[t[9]||(t[9]=s("h2",{class:"text-lg font-bold mb-4"},"Collections",-1)),(n(!0),c(S,null,w(q.value,r=>(n(),c("div",{key:r.id,class:"mb-2"},[s("button",{class:"bg-darkOrange text-mintGreen py-2 px-4 rounded-xl w-3/4 mb-4",onClick:me=>j(r.id)},G(r.title),9,pe)]))),128))])]),_:1}),s("div",de,[s("ul",ve,[g(h(k),{href:e.route("about")},{default:v(()=>t[10]||(t[10]=[s("li",null,"About",-1)])),_:1},8,["href"]),g(h(k),{href:e.route("career")},{default:v(()=>t[11]||(t[11]=[s("li",null,"Career",-1)])),_:1},8,["href"]),g(h(k),{href:e.route("terms")},{default:v(()=>t[12]||(t[12]=[s("li",null,"Terms of service",-1)])),_:1},8,["href"])])])])])]),_:1}))}},ke=Z(fe,[["__scopeId","data-v-3680de6a"]]);export{ke as default};
